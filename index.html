<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Salidas Pendientes üêì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --purple-base: #B548DB;
            --purple-dark: #8B2FA8;
            --purple-medium: #B548DB;
            --purple-light: #D17BF0;
            --purple-pale: #E5B0F5;
            --black: #1a1a1a;
            --white: #fff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--black) 0%, var(--purple-base) 50%, var(--black) 100%);
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animaciones de fondo - Pollos y Gallos */
        .floating-chicken {
            position: fixed;
            font-size: 2.5rem;
            opacity: 0.15;
            animation: float 15s infinite ease-in-out;
            pointer-events: none;
            z-index: 0;
        }

        @media (max-width: 768px) {
            .floating-chicken {
                font-size: 2rem;
                opacity: 0.1;
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-50px) rotate(10deg); }
        }

        .chicken-1 { top: 10%; left: 10%; animation-delay: 0s; }
        .chicken-2 { top: 30%; right: 15%; animation-delay: 2s; }
        .chicken-3 { bottom: 20%; left: 20%; animation-delay: 4s; }
        .chicken-4 { bottom: 40%; right: 10%; animation-delay: 6s; }
        .chicken-5 { top: 60%; left: 5%; animation-delay: 8s; }

        /* Contenedor principal */
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            width: 100%;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 25px;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            color: var(--white);
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px var(--purple-light);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px var(--purple-light); }
            to { text-shadow: 0 0 30px var(--purple-pale), 0 0 40px var(--purple-light); }
        }

        .header p {
            color: var(--purple-pale);
            font-size: 0.95rem;
        }

        /* Bot√≥n agregar cita */
        .add-btn {
            background: linear-gradient(135deg, var(--purple-medium), var(--purple-light));
            color: var(--white);
            border: none;
            padding: 12px 24px;
            font-size: 0.9rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px auto;
            display: block;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(181, 72, 219, 0.5);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            width: auto;
            max-width: 300px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(156, 39, 176, 0.6);
        }

        .add-btn:active {
            transform: scale(0.95);
        }

        /* Lista de citas */
        .dates-list {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .date-card {
            background: linear-gradient(135deg, rgba(181, 72, 219, 0.25), rgba(139, 47, 168, 0.35));
            border: 2px solid var(--purple-medium);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.6s ease forwards;
            opacity: 0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .date-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(181, 72, 219, 0.25) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .date-card:hover::before {
            opacity: 1;
        }

        .date-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 10px 30px rgba(181, 72, 219, 0.5);
            border-color: var(--purple-pale);
        }

        .date-card:nth-child(1) { animation-delay: 0.1s; }
        .date-card:nth-child(2) { animation-delay: 0.2s; }
        .date-card:nth-child(3) { animation-delay: 0.3s; }
        .date-card:nth-child(4) { animation-delay: 0.4s; }
        .date-card:nth-child(5) { animation-delay: 0.5s; }

        .date-title {
            color: var(--white);
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .date-emoji {
            font-size: 1.5rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-10px) rotate(5deg); }
        }

        .date-card:hover .date-emoji {
            animation: spin 0.5s ease;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--purple-dark), var(--black));
            border: 2px solid var(--purple-medium);
            border-radius: 20px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 15px 40px rgba(181, 72, 219, 0.5);
            animation: modalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin: 10px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: var(--white);
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.3s;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            transform: rotate(90deg) scale(1.2);
            color: var(--purple-pale);
        }

        .modal-title {
            color: var(--white);
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .modal-section {
            margin-bottom: 20px;
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
        }

        .modal-section:nth-child(2) { animation-delay: 0.1s; }
        .modal-section:nth-child(3) { animation-delay: 0.2s; }
        .modal-section:nth-child(4) { animation-delay: 0.3s; }
        .modal-section:nth-child(5) { animation-delay: 0.4s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            color: var(--purple-pale);
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid var(--purple-light);
            padding-bottom: 8px;
        }

        .section-list {
            list-style: none;
            padding-left: 0;
        }

        .section-list li {
            color: var(--white);
            padding: 6px 10px;
            margin: 5px 0;
            background: rgba(181, 72, 219, 0.3);
            border-left: 3px solid var(--purple-medium);
            border-radius: 6px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .section-list li::before {
            content: 'üêì';
            font-size: 0.9rem;
        }

        .section-list li:hover {
            background: rgba(181, 72, 219, 0.5);
            transform: translateX(5px);
            border-left-color: var(--purple-pale);
        }

        .presupuesto {
            background: linear-gradient(135deg, var(--purple-medium), var(--purple-light));
            color: var(--white);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 3px 15px rgba(181, 72, 219, 0.4);
        }

        .edit-btn {
            background: linear-gradient(135deg, var(--purple-medium), var(--purple-light));
            color: var(--white);
            border: none;
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            margin: 20px auto 0;
            display: block;
            box-shadow: 0 3px 15px rgba(181, 72, 219, 0.4);
            transition: all 0.3s;
        }

        .edit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(181, 72, 219, 0.6);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .delete-btn {
            background: rgba(255, 59, 48, 0.18);
            color: var(--white);
            border: 1px solid rgba(255, 59, 48, 0.65);
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            box-shadow: 0 3px 15px rgba(255, 59, 48, 0.25);
            transition: all 0.3s;
        }

        .delete-btn:hover {
            transform: scale(1.05);
            background: rgba(255, 59, 48, 0.28);
            box-shadow: 0 5px 20px rgba(255, 59, 48, 0.35);
        }

        /* Formulario agregar cita */
        .form-modal {
            display: none;
        }

        .form-modal.active {
            display: flex;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            color: var(--purple-pale);
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--purple-light);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .ingredientes-input,
        .materiales-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .ingredientes-input input,
        .materiales-input input {
            flex: 1;
        }

        .add-item-btn {
            background: var(--purple-medium);
            color: var(--white);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
        }

        .items-list {
            list-style: none;
            margin-top: 10px;
        }

        .items-list li {
            background: rgba(181, 72, 219, 0.3);
            padding: 6px 10px;
            margin: 4px 0;
            border-radius: 5px;
            color: var(--white);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .remove-item {
            background: rgba(255, 0, 0, 0.3);
            border: none;
            color: var(--white);
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .form-buttons button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn {
            background: linear-gradient(135deg, var(--purple-medium), var(--purple-light));
            color: var(--white);
        }

        .cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border: 2px solid var(--purple-light);
        }

        .form-buttons button:hover {
            transform: scale(1.05);
        }

        /* Scrollbar personalizado */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(156, 39, 176, 0.1);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--purple-light);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: var(--purple-pale);
        }

        /* Responsive Design para m√≥viles y Android */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
                line-height: 1.3;
            }

            .header p {
                font-size: 0.85rem;
            }
            
            .date-card {
                padding: 12px;
                border-radius: 12px;
            }

            .date-title {
                font-size: 1rem;
                gap: 8px;
            }

            .date-emoji {
                font-size: 1.3rem;
            }

            .add-btn {
                padding: 10px 20px;
                font-size: 0.85rem;
                width: 90%;
                max-width: 280px;
            }

            .modal-content {
                padding: 20px 15px;
                width: 95%;
                max-width: 95%;
                border-radius: 15px;
                margin: 5px;
            }

            .modal-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
                gap: 8px;
                flex-wrap: wrap;
            }

            .section-title {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .section-list li {
                font-size: 0.8rem;
                padding: 6px 8px;
                margin: 4px 0;
            }

            .presupuesto {
                padding: 10px;
                font-size: 0.9rem;
            }

            .close-btn {
                font-size: 1.8rem;
                top: 8px;
                right: 12px;
                width: 30px;
                height: 30px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-group label {
                font-size: 0.85rem;
            }

            .form-group input,
            .form-group textarea {
                padding: 8px 10px;
                font-size: 0.85rem;
            }

            .form-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .form-buttons button {
                width: 100%;
                padding: 10px;
            }

            .edit-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
                width: 90%;
                max-width: 200px;
            }

            .modal-actions {
                flex-direction: column;
                gap: 10px;
            }

            .delete-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
                width: 90%;
                max-width: 200px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3rem;
            }

            .date-card {
                padding: 10px;
            }

            .date-title {
                font-size: 0.95rem;
            }

            .modal-content {
                padding: 15px 12px;
            }

            .modal-title {
                font-size: 1.1rem;
            }
        }

        /* Mejoras para Android espec√≠ficamente */
        @media screen and (max-width: 768px) and (orientation: portrait) {
            .modal-content {
                max-height: 90vh;
            }

            .dates-list {
                gap: 15px;
            }
        }

        @media screen and (max-width: 768px) and (orientation: landscape) {
            .header {
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .modal-content {
                max-height: 95vh;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Pollos flotantes de fondo -->
    <div class="floating-chicken chicken-1">üêì</div>
    <div class="floating-chicken chicken-2">üêî</div>
    <div class="floating-chicken chicken-3">üêì</div>
    <div class="floating-chicken chicken-4">üêî</div>
    <div class="floating-chicken chicken-5">üêì</div>

    <div class="container">
        <div class="header">
            <h1>üêì Citas üêî</h1>
        </div>

        <button class="add-btn" onclick="openAddForm()">
            ‚ûï Agregar Nuevo Plan
        </button>

        <div class="dates-list" id="datesList">
            <!-- Las citas se cargar√°n aqu√≠ din√°micamente -->
        </div>
    </div>

    <!-- Modal para detalles de cita -->
    <div class="modal" id="dateModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Modal para agregar nueva cita -->
    <div class="modal form-modal" id="addFormModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAddForm()">&times;</button>
            <div class="modal-title">‚ú® Nuevo Plan Ma√±oso ‚ú®</div>
            
            <form id="addDateForm">
                <div class="form-group">
                    <label>üêî T√≠tulo</label>
                    <input type="text" id="newTitle" placeholder="Agregar titulo" required>
                </div>

                <div class="form-group">
                    <label>Ingredientes</label>
                    <div class="ingredientes-input">
                        <input type="text" id="ingredienteInput" placeholder="Agregar ingrediente">
                        <button type="button" class="add-item-btn" onclick="addItem('ingredienteInput', 'ingredientesList')">+</button>
                    </div>
                    <ul class="items-list" id="ingredientesList"></ul>
                </div>

                <div class="form-group">
                    <label>Materiales</label>
                    <div class="materiales-input">
                        <input type="text" id="materialInput" placeholder="Agregar material">
                        <button type="button" class="add-item-btn" onclick="addItem('materialInput', 'materialesList')">+</button>
                    </div>
                    <ul class="items-list" id="materialesList"></ul>
                </div>

                <div class="form-group">
                    <label>üí∞ Presupuesto</label>
                    <input type="text" id="newPresupuesto" placeholder="$10 - $20">
                </div>

                <div class="form-buttons">
                    <button type="submit" class="save-btn">üíæ Guardar Cita</button>
                    <button type="button" class="cancel-btn" onclick="closeAddForm()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN JSONBIN - Datos compartidos online
        // ============================================
        const JSONBIN_BIN_ID = '695dfdb6ae596e708fca7a24';
        const JSONBIN_API_KEY = '$2a$10$8rL1Cop5QdfFHG6fKyjdiugUrJEAOr9A8dihgWe1DfJziH3eRNIPS';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        let dates = [];
        let nextId = 100;
        let isLoading = false;

        // Emojis aleatorios para las citas
        const randomEmojis = ['üíï', '‚ù§Ô∏è', 'üíú', 'üå∫', 'üå∏', 'üåπ', 'üé¨', 'üçù', 'üö¥', 'üé®', 'üé≠', 'üé™', 'üé°', 'üé¢', 'üé†', 'üéØ', 'üé≤', 'üéÆ', 'üé∏', 'üéπ', 'üé∫', 'üéª', 'ü•Å', 'üé§', 'üéß', 'üéº', 'üçï', 'üçî', 'üçü', 'üçø', 'üßÅ', 'üç∞', 'üéÇ', 'üç™', 'üç©', 'üç¶', 'üç®', 'üßÉ', 'ü•§', '‚òï', 'üçµ', 'üåÆ', 'üåØ', 'ü•ô', 'ü•ó', 'üç±', 'üçú', 'üç≤', 'ü•ò', 'üçõ', 'üç£', 'üç§', 'ü¶û', 'ü¶Ä', 'üêô', 'ü¶ë', 'üå≠', 'ü•™', 'ü•ñ', 'ü•ê', 'ü•Ø', 'üßÄ', 'ü•ö', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå∂Ô∏è', 'ü´ë', 'ü•í', 'ü•¨', 'ü•¶', 'üßÑ', 'üßÖ', 'üçÑ', 'ü•ú', 'üå∞', 'üçû', 'ü•®', 'ü•û', 'üßá', 'üßà', 'üçØ'];
        
        // Funci√≥n para obtener emoji aleatorio
        function getRandomEmoji() {
            return randomEmojis[Math.floor(Math.random() * randomEmojis.length)];
        }

        // Mostrar estado de carga
        function showLoading(message = 'Cargando...') {
            const datesList = document.getElementById('datesList');
            datesList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--purple-pale);">
                    <div style="font-size: 2rem; animation: spin 1s linear infinite;">üêì</div>
                    <p style="margin-top: 10px;">${message}</p>
                </div>
            `;
        }

        // Cargar citas desde JSONBin
        async function loadDates() {
            if (isLoading) return;
            isLoading = true;
            showLoading('Cargando citas...');
            
            try {
                const response = await fetch(`${JSONBIN_URL}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Access-Key': JSONBIN_API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                dates = data.record || [];
                
                // Asegurar que dates sea un array
                if (!Array.isArray(dates)) {
                    dates = [];
                }
                
                // Asignar emojis aleatorios a las citas que no tengan
                dates = dates.map(date => ({
                    ...date,
                    emoji: date.emoji || getRandomEmoji()
                }));
                
                // Calcular nextId
                if (dates.length > 0) {
                    nextId = Math.max(...dates.map(d => d.id || 0)) + 1;
                }
                
                console.log('‚úÖ Citas cargadas desde JSONBin:', dates.length);
                renderDates();
            } catch (error) {
                console.error('‚ùå Error cargando desde JSONBin:', error);
                dates = [];
                renderDates();
                showError('Error al cargar las citas. Verifica tu conexi√≥n.');
            } finally {
                isLoading = false;
            }
        }

        // Guardar citas en JSONBin
        async function saveDates() {
            try {
                showLoading('Guardando...');
                
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(dates)
                });
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                console.log('‚úÖ Citas guardadas en JSONBin');
                return true;
            } catch (error) {
                console.error('‚ùå Error guardando en JSONBin:', error);
                showError('Error al guardar. Intenta de nuevo.');
                return false;
            }
        }

        // Mostrar mensaje de error
        function showError(message) {
            alert(`‚ùå ${message}`);
        }

        // Renderizar lista de citas
        function renderDates() {
            const datesList = document.getElementById('datesList');
            datesList.innerHTML = '';

            if (dates.length === 0) {
                datesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--purple-pale);">
                        <div style="font-size: 3rem;">üêì</div>
                        <p style="margin-top: 10px;">No hay citas a√∫n. ¬°Agrega una nueva!</p>
                    </div>
                `;
                return;
            }

            dates.forEach((date, index) => {
                const card = document.createElement('div');
                card.className = 'date-card';
                card.style.animationDelay = `${index * 0.1}s`;
                
                // Usar emoji aleatorio si no tiene uno asignado
                const emoji = date.emoji || getRandomEmoji();
                
                card.innerHTML = `
                    <div class="date-title">
                        <span class="date-emoji">${emoji}</span>
                        <span>${date.title}</span>
                    </div>
                `;
                card.onclick = () => openModal(date);
                datesList.appendChild(card);
            });
        }

        // Variable global para la cita actual
        let currentDate = null;

        // Abrir modal con detalles
        function openModal(date) {
            currentDate = date;
            const modal = document.getElementById('dateModal');
            const content = document.getElementById('modalContent');
            
            // Usar emoji aleatorio si no tiene uno
            const emoji = date.emoji || getRandomEmoji();
            
            content.innerHTML = `
                <div class="modal-title">
                    <span>${emoji}</span>
                    <span>${date.title}</span>
                </div>
                
                <div class="modal-section">
                    <div class="section-title">
                        <span>üçΩÔ∏è Ingredientes</span>
                    </div>
                    <ul class="section-list">
                        ${date.ingredientes.map(ing => `<li>${ing}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="modal-section">
                    <div class="section-title">
                        <span>üì¶ Materiales</span>
                    </div>
                    <ul class="section-list">
                        ${date.materiales.map(mat => `<li>${mat}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="modal-section">
                    <div class="presupuesto">
                        üí∞ Presupuesto: ${date.presupuesto || 'Por definir'}
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="edit-btn" onclick="openEditForm(${date.id})">
                        ‚úèÔ∏è Editar
                    </button>
                    <button class="delete-btn" onclick="deleteDate(${date.id})" title="Eliminar">
                        ‚úñ Eliminar
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Eliminar cita
        async function deleteDate(dateId) {
            const date = dates.find(d => d.id === dateId);
            if (!date) return;

            const ok = confirm(`¬øEliminar este plan?\n\n"${date.title}"\n\nEsto se borrar√° para ambos (JSONBin).`);
            if (!ok) return;

            const prevDates = [...dates];
            dates = dates.filter(d => d.id !== dateId);

            const saved = await saveDates();
            if (saved) {
                closeModal();
                renderDates();
                alert('‚úÖ Plan eliminado');
                return;
            }

            // Si fall√≥, restaurar y recargar desde el bin para quedar consistentes
            dates = prevDates;
            renderDates();
            await loadDates();
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('dateModal').classList.remove('active');
        }

        // Abrir formulario de agregar
        function openAddForm() {
            // Resetear formulario
            document.getElementById('addDateForm').reset();
            document.getElementById('ingredientesList').innerHTML = '';
            document.getElementById('materialesList').innerHTML = '';
            document.getElementById('addDateForm').dataset.editMode = 'false';
            document.getElementById('addDateForm').dataset.editId = '';
            
            // Cambiar t√≠tulo del modal
            document.querySelector('#addFormModal .modal-title').textContent = '‚ú® Nuevo Plan Ma√±oso ‚ú®';
            
            // Cambiar texto del bot√≥n
            const submitBtn = document.querySelector('#addDateForm button[type="submit"]');
            submitBtn.textContent = 'üíæ Guardar Cita';
            
            document.getElementById('addFormModal').classList.add('active');
        }

        // Cerrar formulario de agregar
        function closeAddForm() {
            document.getElementById('addFormModal').classList.remove('active');
            document.getElementById('addDateForm').reset();
            document.getElementById('ingredientesList').innerHTML = '';
            document.getElementById('materialesList').innerHTML = '';
            document.getElementById('addDateForm').dataset.editMode = 'false';
            document.getElementById('addDateForm').dataset.editId = '';
        }

        // Abrir formulario de edici√≥n
        function openEditForm(dateId) {
            const date = dates.find(d => d.id === dateId);
            if (!date) return;
            
            // Cerrar el modal de detalles
            closeModal();
            
            // Preparar el formulario
            document.getElementById('newTitle').value = date.title;
            document.getElementById('newPresupuesto').value = date.presupuesto || '';
            
            // Limpiar listas
            const ingredientesList = document.getElementById('ingredientesList');
            const materialesList = document.getElementById('materialesList');
            ingredientesList.innerHTML = '';
            materialesList.innerHTML = '';
            
            // Agregar ingredientes
            date.ingredientes.forEach(ing => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${ing}
                    <button type="button" class="remove-item" onclick="this.parentElement.remove()">√ó</button>
                `;
                ingredientesList.appendChild(li);
            });
            
            // Agregar materiales
            date.materiales.forEach(mat => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${mat}
                    <button type="button" class="remove-item" onclick="this.parentElement.remove()">√ó</button>
                `;
                materialesList.appendChild(li);
            });
            
            // Cambiar t√≠tulo del modal
            document.querySelector('#addFormModal .modal-title').textContent = '‚úèÔ∏è Editar Plan ‚ú®';
            
            // Marcar como modo edici√≥n
            document.getElementById('addDateForm').dataset.editMode = 'true';
            document.getElementById('addDateForm').dataset.editId = dateId;
            
            // Cambiar texto del bot√≥n
            const submitBtn = document.querySelector('#addDateForm button[type="submit"]');
            submitBtn.textContent = 'üíæ Guardar Cambios';
            
            // Abrir modal
            document.getElementById('addFormModal').classList.add('active');
        }

        // Agregar item a lista
        function addItem(inputId, listId) {
            const input = document.getElementById(inputId);
            const list = document.getElementById(listId);
            const value = input.value.trim();
            
            if (value) {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${value}
                    <button type="button" class="remove-item" onclick="this.parentElement.remove()">√ó</button>
                `;
                list.appendChild(li);
                input.value = '';
            }
        }

        // Permitir Enter en inputs
        document.getElementById('ingredienteInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addItem('ingredienteInput', 'ingredientesList');
            }
        });

        document.getElementById('materialInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addItem('materialInput', 'materialesList');
            }
        });

        // Guardar o editar cita
        document.getElementById('addDateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = document.getElementById('addDateForm');
            const isEditMode = form.dataset.editMode === 'true';
            const editId = parseInt(form.dataset.editId);
            
            const ingredientes = Array.from(document.getElementById('ingredientesList').children)
                .map(li => li.textContent.replace('√ó', '').trim());
            
            const materiales = Array.from(document.getElementById('materialesList').children)
                .map(li => li.textContent.replace('√ó', '').trim());
            
            if (isEditMode) {
                // Editar cita existente
                const dateIndex = dates.findIndex(d => d.id === editId);
                if (dateIndex !== -1) {
                    // Actualizar la cita
                    dates[dateIndex] = {
                        ...dates[dateIndex],
                        title: document.getElementById('newTitle').value,
                        ingredientes: ingredientes.length > 0 ? ingredientes : ['Por definir'],
                        materiales: materiales.length > 0 ? materiales : ['Por definir'],
                        presupuesto: document.getElementById('newPresupuesto').value || 'Por definir',
                        emoji: dates[dateIndex].emoji || getRandomEmoji()
                    };
                    
                    // Guardar en JSONBin
                    const saved = await saveDates();
                    if (saved) {
                        renderDates();
                        closeAddForm();
                        alert('üêì ¬°Cita actualizada exitosamente! üêî');
                    } else {
                        renderDates();
                    }
                }
            } else {
                // Agregar nueva cita con emoji aleatorio
                const newDate = {
                    id: nextId++,
                    title: document.getElementById('newTitle').value,
                    ingredientes: ingredientes.length > 0 ? ingredientes : ['Por definir'],
                    materiales: materiales.length > 0 ? materiales : ['Por definir'],
                    presupuesto: document.getElementById('newPresupuesto').value || 'Por definir',
                    emoji: getRandomEmoji()
                };
                
                // Agregar a la lista actual
                dates.push(newDate);
                
                // Guardar en JSONBin
                const saved = await saveDates();
                if (saved) {
                    renderDates();
                    closeAddForm();
                    alert('üêì ¬°Cita agregada exitosamente! üêî');
                } else {
                    // Si falla, quitar la cita agregada
                    dates.pop();
                    nextId--;
                    renderDates();
                }
            }
        });

        // Cerrar modal al hacer click fuera
        window.onclick = function(event) {
            const dateModal = document.getElementById('dateModal');
            const formModal = document.getElementById('addFormModal');
            if (event.target === dateModal) {
                closeModal();
            }
            if (event.target === formModal) {
                closeAddForm();
            }
        }

        // Cargar citas al iniciar
        loadDates();
    </script>
</body>
</html>

